function selectResult(e,t){if(1==e.length)return e[0].querySelectorAll(t);for(var r=[],a=0;a<e.length;a++){var n=e[a],i=angular.element(n.querySelectorAll(t));r.push.apply(r,i.slice())}return r}var bg=bg||!1;bg||("undefined"!=typeof jQuery?bg=jQuery:"undefined"!=typeof angular&&(bg=angular.element,bg.extend=angular.extend,bg.prototype.find=function(e){var t=this[0];if(!t||1!==t.nodeType&&9!==t.nodeType||!angular.isString(e))return[];var r=[];if(">"===e.charAt(0)&&(e=":scope "+e),e.indexOf(":visible")>-1){var a=angular.element(selectResult(this,e.split(":visible")[0]));forEach(a,function(e,t){angular.element(e).is(":visible")&&r.push(e)})}else r=selectResult(this,e);return r.length?1==r.length?angular.element(r[0]):angular.element(r):angular.element()})),function(e){"use strict";var t="recorder",r=!(navigator.userAgent.indexOf("Edge")===-1||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob),a=function(e,t,r){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?void navigator.mediaDevices.getUserMedia(e).then(t)["catch"](r):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia?void navigator.getUserMedia(e,t,r):void r("Browser not compatible, sorry!"))},n=function(e){function t(){if(r=1e3*s-(Date.now()-o|0),a.$timer.html('<span class="txt-info">'+i.text.remaining_recording+'</span><span class="time-info">'+a._timeToString(r)+"</span>"),!r)return void n.call(a,!0)}var r,a=this,i=a.settings,o=a.timerStartedAt?a.timerStartedAt:Date.now(),s=i.limit;return a.timerStoppedAt&&(o+=Date.now()-a.timerStoppedAt),e?(clearInterval(a.timerRunning),a.$timer.css("display","none"),delete a.timerStartedAt,void delete a.timerStoppedAt):a.timerStartedAt&&a.isPaused?(clearInterval(a.timerRunning),void(a.timerStoppedAt=Date.now())):(t(),a.timerRunning=setInterval(t,1e3),void(a.timerStartedAt=o))},i=function(){var e=this,t=(e.settings,!1),r=e.recordRTCInstance;return r.length?(t=r[1]?1:0,r[t]):r},o=function(){var e,t,r,a,n=this,i=n.settings,s=n.getRecordedData(),d=n.$uploadstatus;if(s&&(i.flowOpts&&"undefined"!=typeof Flow||"function"==typeof i.uploader))return i.uploader?void i.uploader(s):void("undefined"!=typeof Flow&&(e=new Flow(i.flowOpts),s.name=i.filename||"recorded_data",e.addFile(s),e.upload(),d.find(".progress, .progress-bar").addClass("active").css("cursor","").removeClass("progress-bar-success bar-success progress-bar-danger bar-danger"),d.css("display",""),n.$element.triggerHandler("upload_start.recorder"),n.isUploading=!0,n.uploadCompleted=!1,t=function(t){n.$element.triggerHandler("upload_progress.recorder",t);var r=i.text.upload_speed+n._humanize(t.averageSpeed)+"/s "+n._timeToString(1e3*t.timeRemaining())+i.text.time_remaining;d.find(".txt-info").html(r).css("display",""),d.find(".progress-bar").css({width:Math.floor(100*e.progress())+"%"})},"function"==typeof i.onFileProgress&&(t=i.onFileProgress),e.on("fileProgress",t),r=function(e,t,r){n.isUploading=!1,n.uploadCompleted=!0,n.$element.triggerHandler("upload_completed.recorder",[e,t,r]),d.find(".progress, .progress-bar").removeClass("active progress-striped").addClass("progress-bar-success bar-success"),d.find(".progress-bar").html(i.text.completed),d.find(".txt-info").css("display","none")},"function"==typeof i.onFileSuccess&&(r=i.onFileSuccess),e.on("fileSuccess",r),a=function(e,t,r){n.isUploading=!1,n.$element.triggerHandler("upload_error.recorder",[e,t,r]),d.find(".progress, .progress-bar").removeClass("active progress-striped").addClass("progress-bar-danger bar-danger"),d.find(".progress-bar").html(i.text.upload_error).css("cursor","pointer").on("click",function(){o.call(n)}),d.find(".txt-info").css("display","none")},"function"==typeof i.onFileError&&(a=i.onFileError),e.on("fileError",a)))},s=function(){var e=this,t=e.settings;t.streamType;if(e.stream){for(var r=e.stream.getVideoTracks().concat(e.stream.getAudioTracks()),a=0;a<r.length;a++)r[a].stop&&r[a].stop();e.stream=null}e.$element.triggerHandler("stream_stop.recorder"),e.visualizer&&(clearInterval(e.visualizer),e.$visualizer.css("display","none")),e.$postviewEl.length?e.$previewEl.css("display","none"):e.$previewEl.css("display","")},d=function(e){var t=this,r=t.settings,n=t.$previewEl[0],i=r.streamType;t.$previewEl.css("display",""),t.$postviewEl.length&&t.$postviewEl.css("display","none"),a(e,function(e){function a(){var e=c,t=20,r=10,a=60;d.getFloatFrequencyData(e),u.clearRect(0,0,p,256),u.beginPath(),u.moveTo(.5,255.5-255.5*t*Math.pow(r,e[0]/t));for(var n=1;n<e.length;n++)u.lineTo(Math.log(n)*a,255.5-255.5*t*Math.pow(r,e[n]/t));u.stroke()}if(t.stream=e,t.$element.triggerHandler("stream_start.recorder"),n.srcObject=e,n.muted=!0,n.play(),"audio"==i&&t.$visualizer.length){t.$visualizer.css("display",""),window.AudioContext=window.AudioContext||window.webkitAudioContext;var o=t.$visualizer[0],s=new AudioContext,d=s.createAnalyser(),l=s.createGain();l.gain.value=0,d.fftSize=2048;var c=new Float32Array(d.frequencyBinCount);d.connect(l),l.connect(s.destination);var p=d.frequencyBinCount,u=o.getContext("2d");o.width=400,o.height=256,t.visualizer=setInterval(a,20);var g=s.createMediaStreamSource(e);g.connect(d)}t.onMediaCaptured(),"function"==typeof r.onMediaStopped&&(e.onended=r.onMediaStopped)},function(e){"function"==typeof r.onMediaCapturingFailed&&r.onMediaCapturingFailed(e)})},l=function(){var t=this,r=t.settings,a=e('<div class="msr-preview"></div>'),n=r.streamType;switch(t.$postviewEl=[],n){case"video":case"gif":t.$previewEl=e("<video></video>");break;case"audio":t.$visualizer=e('<canvas style="background-color: #ddd;" class="visualizer"></canvas>').css("display","none"),a.append(t.$visualizer),t.$previewEl=e("<audio></audio>");break;case"image":t.$previewEl=e("<video></video>"),t.$postviewEl=e("<img />")}t.$previewEl.css("display","none"),a.append(t.$previewEl),t.$postviewEl.length&&(t.$postviewEl.css("display","none"),a.append(t.$postviewEl)),t.$element.append(a)},c=function(){var t,r=this,a=r.settings,n=e('<div class="msr-panel"></div>'),i=a.streamType,o="image"!=i?a.text.record:a.text.enable_webcam,s="image"!=i?a.text.stop:a.text.take_snapshot;t=e('<div class="btn btn-danger btn-record">'+o+"</div>"),t.on("click",function(){r.record()}).css("display",""),n.append(t),"image"==i||a.limit&&a.disablePause||(t=e('<div class="btn btn-warning btn-pause">'+a.text.pause+"</div>"),t.on("click",function(){r.togglePause()}).css("display","none"),n.append(t),t=e('<div class="btn btn-danger btn-resume">'+a.text.resume+"</div>"),t.on("click",function(){r.togglePause()}).css("display","none"),n.append(t)),a.limit&&a.disableStop||(t=e('<div class="btn btn-primary btn-stop">'+s+"</div>"),t.on("click",function(){r.stop()}).css("display","none"),n.append(t)),r.$element.append(n)},p={init:function(t,r){var a=this;a.$element=t,a.settings=e.extend({},{streamType:"video",audio:!0,showTimer:!0,bufferSize:16384,frameInterval:20,leftChannel:!1,sampleRate:44100,canvas_height:240,canvas_width:320,disableLogs:!0,audioFormat:"",videoFormat:"",limit:0,flowOpts:!1,disableStop:!1,disablePause:!1,text:{enable_webcam:"Enable webcam",take_snapshot:"Take snapshot",time_remaining:" time remaining",upload_speed:"upload speed: ",upload_error:"Upload error, click here to retry",completed:"upload completed",remaining_recording:"Remaining recording time ",record:"Record",pause:"Pause",resume:"Resume",stop:"Stop"}},r);var a=this,n=a.settings;n.streamType=n.streamType.trim().toLowerCase(),n.streamType=/(audio|video|gif|image)/i.test(n.streamType)?n.streamType:"stream",n.audioFormat=n.audioFormat.trim().toLowerCase(),n.audioFormat=/(wav|ogg)/i.test(n.audioFormat)?n.audioFormat:"ogg",n.videoFormat=n.videoFormat.trim().toLowerCase(),n.videoFormat=/(webm|mp4)/i.test(n.videoFormat)?n.videoFormat:"webm",l.call(a),n.showTimer&&(a.$timer=e('<div class="msr-timer"></div>'),a.$element.append(a.$timer)),n.showTimer&&(a.$uploadstatus=e('<div class="msr-upload-status"><div class="progress progress-striped active"><div class="bar progress-bar progress-striped active"></div></div><span class="txt-info"></span></div>').css("display","none"),a.$element.append(a.$uploadstatus)),c.call(a)},getRecordedData:function(){return this.recordedData},record:function(){var e,t=this,a=t.settings,l=t.$element.find(".msr-panel"),c=a.streamType,p=t.$previewEl[0];switch(delete t.recordedData,l.length&&(l.find(".btn-pause, .btn-stop").css("display",""),l.find(".btn-record, .btn-resume").css("display","none")),t.recordingEnded=function(e){var r=i.call(t),a="gif"!=c?"src":"poster";p.src=null,p.srcObject=null,p.muted=!1,p.removeAttribute("muted"),p.pause(),p[a]=e,"gif"!=c&&(p.setAttribute("controls","controls"),p.controls=!0,p.play()),p.onended=function(){p.pause(),p[a]=URL.createObjectURL(r.blob)},t.recordedData=r.blob,t.$element.triggerHandler("recording_ended.recorder"),s.call(t),o.call(t)},c){case"video":case"gif":t.onMediaCaptured=function(){if("video"==c&&a.audio&&"undefined"==typeof MediaRecorder){var e={type:"audio",bufferSize:parseInt(a.bufferSize),sampleRate:parseInt(a.sampleRate),leftChannel:a.leftChannel,disableLogs:a.disableLogs,recorderType:r?StereoAudioRecorder:null};"undefined"==typeof a.sampleRate&&delete a.sampleRate;var i=RecordRTC(t.stream,e),o=RecordRTC(t.stream,{type:"video",disableLogs:a.disableLogs,canvas:{width:a.canvas_width,height:a.canvas_height},getNativeBlob:!0,frameInterval:"undefined"!=typeof a.frameInterval?parseInt(a.frameInterval):20});a.limit&&(o.setRecordingDuration(1e3*a.limit).onRecordingStopped(function(e){t.stop(e)}),i.setRecordingDuration(1e3*a.limit).onRecordingStopped(function(e){t.stop(e)})),o.initRecorder(function(){i.initRecorder(function(){i.startRecording(),o.startRecording(),t.$element.triggerHandler("recording_started.recorder"),a.showTimer&&n.call(t)})}),t.recordRTCInstance=[i,o]}else t.recordRTCInstance=RecordRTC(t.stream,{type:c,mimeType:"video/"+a.videoFormat,disableLogs:a.disableLogs,canvas:{width:a.canvas_width,height:a.canvas_height},getNativeBlob:!0,frameInterval:"undefined"!=typeof a.frameInterval?parseInt(a.frameInterval):20}),a.limit&&t.recordRTCInstance.setRecordingDuration(1e3*a.limit).onRecordingStopped(function(e){t.stop(e)}),t.recordRTCInstance.startRecording(),t.$element.triggerHandler("recording_started.recorder"),a.showTimer&&n.call(t)},e={video:!0},a.audio&&(e.audio=!0),d.call(t,e);break;case"audio":t.onMediaCaptured=function(){t.recordRTCInstance=RecordRTC(t.stream,{type:c,mimeType:"audio/"+a.audioFormat,bufferSize:parseInt(a.bufferSize),sampleRate:parseInt(a.sampleRate),leftChannel:a.leftChannel,disableLogs:a.disableLogs,recorderType:r?StereoAudioRecorder:null}),a.limit&&t.recordRTCInstance.setRecordingDuration(1e3*a.limit).onRecordingStopped(function(e){t.stop(e)}),t.recordRTCInstance.startRecording(),t.$element.triggerHandler("recording_started.recorder"),a.showTimer&&n.call(t)},e={audio:!0},d.call(t,e);break;case"image":t.onMediaCaptured=function(){},t.recordingEnded=function(e){var r=document.createElement("canvas");r.width=p.videoWidth||p.clientWidth,r.height=p.videoHeight||p.clientHeight;var a=r.getContext("2d");a.drawImage(p,0,0,r.width,r.height),t.recordedData=r.toDataURL("image/jpeg"),t.$postviewEl.css("display","")[0].src=t.recordedData,t.recordedData=t._dataURItoBlob(t.recordedData),t.$element.triggerHandler("recording_ended.recorder"),s.call(t),o.call(t)},e={video:!0},d.call(t,e)}},togglePause:function(){var e=this,t=(e.settings,e.$element.find(".msr-panel")),r=!0,a="pause",i=".btn-resume";t.length&&(t.find(".btn-stop").css("display",""),t.find(".btn-record, .btn-resume, .btn-pause").css("display","none"));var o=e.recordRTCInstance;e.recordRTCInstance.length||(o=[e.recordRTCInstance]),e.isPaused&&(a="resume",r=!1,i=".btn-pause");for(var s=0;s<o.length;s++){var d=o[s];d[a+"Recording"]&&d[a+"Recording"]()}e.$element.triggerHandler("recording_"+a+"d.recorder"),t.find(i).css("display",""),e.isPaused=r,n.call(e)},stop:function(e){var t=this,r=t.settings,a=t.$element.find(".msr-panel"),o=t.recordRTCInstance;if(a.length&&(a.find(".btn-record").css("display",""),a.find(".btn-resume, .btn-pause, .btn-stop").css("display","none")),n.call(t,!0),"image"==r.streamType)return void t.recordingEnded(e);if(o){if(t.isPaused)return t.togglePause(),void t.stop();if(e)return void t.recordingEnded(e);o=i.call(t),o.stopRecording(function(e){t.recordingEnded(e)})}},_blobToDataURL:function(e,t){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsDataURL(e)},_dataURItoBlob:function(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var r=e.split(",")[0].split(":")[1].split(";")[0],a=new Uint8Array(t.length),n=0;n<t.length;n++)a[n]=t.charCodeAt(n);return new Blob([a],{type:r})},_humanize:function(e){if(0==e)return"0 Byte";var t=["Bytes","KB","MB","GB","TB"],r=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,r),2)+" "+t[r]},_timeToString:function(e){var t,r,a;return e/=1e3,r=e/60|0,t=r/60|0,a=e%60|0,t&&(r-=60*t),t=t<10?"0"+t:t,r=r<10?"0"+r:r,a=a<10?"0"+a:a,("00"==t?"":t+":")+r+":"+a}},u=function(r){var a=this.data(t+"_data");if(a)return"string"==typeof r&&a[r]?a[r].apply(a,Array.prototype.slice.call(arguments,1)):console.log("Method "+r+" does not exist on jQuery."+t);if(!r||"object"==typeof r){for(var n=this.length,i=0;i<n;i++){var o=e(this[i]);a=e.extend({},p),a.init(o,r),o.data(t+"_data",a)}return this}return console.log("jQuery."+t+' is not instantiated. Please call $("selector").'+t+"({options})")};e.fn?e.fn[t]=u:e.prototype[t]=u}(bg);