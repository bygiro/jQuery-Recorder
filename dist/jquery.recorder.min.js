var bg=bg||!1;bg||("undefined"!=typeof jQuery?bg=jQuery:"undefined"!=typeof angular&&(bg=angular.element,bg.extend=angular.extend,bg.prototype.find=function(e){var t=this[0],a=[];if(!t||1!==t.nodeType&&9!==t.nodeType||"string"!=typeof e)return[];for(var r=0;r<this.length;r++){var i=this[r],n=bg(i.querySelectorAll(e));a.push.apply(a,n.slice())}return bg(a)})),function(e){"use strict";var t="recorder",a=!(navigator.userAgent.indexOf("Edge")===-1||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob),r=function(e,t,a){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?void navigator.mediaDevices.getUserMedia(e).then(t)["catch"](a):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia?void navigator.getUserMedia(e,t,a):void a("Browser not compatible, sorry!"))},i={},n=function(e){var t,a=i;return a.canv=a.canv||document.createElement("canvas"),a.ctx=a.ctx||a.canv.getContext("2d"),a.canv.width=a.canv.height=1,a.ctx.drawImage(e,0,0,1,1),t=a.ctx.getImageData(0,0,1,1),t.data[0]+t.data[1]+t.data[2]+t.data[3]},s=function(e){function t(){if(a=1e3*o-(Date.now()-n|0),r.$timer.html('<span class="txt-info">'+i.text.remaining_recording+'</span><span class="time-info">'+r._timeToString(a)+"</span>"),!a)return void s.call(r,!0)}var a,r=this,i=r.settings,n=r.timerStartedAt?r.timerStartedAt:Date.now(),o=i.limit;return r.timerStoppedAt&&(n+=Date.now()-r.timerStoppedAt),e?(clearInterval(r.timerRunning),r.$timer.css("display","none"),delete r.timerStartedAt,void delete r.timerStoppedAt):r.timerStartedAt&&r.isPaused?(clearInterval(r.timerRunning),void(r.timerStoppedAt=Date.now())):(t(),r.timerRunning=setInterval(t,1e3),void(r.timerStartedAt=n))},o=function(){var e=this,t=(e.settings,!1),a=e.RTCinst;if(a)return a.length?(t=a[1]?1:0,a[t]):a},d=function(){function t(){d.$element.triggerHandler("recording_started.recorder"),l.showTimer&&s.call(d)}var r,i,o,d=this,l=d.settings,c=l.streamType,p=1e3*(parseInt(l.limit)||0);if("image"!=c)if("video"==c&&l.audio&&"undefined"==typeof MediaRecorder)r={type:"audio",bufferSize:parseInt(l.bufferSize),sampleRate:parseInt(l.sampleRate),leftChannel:l.leftChannel,disableLogs:l.disableLogs,recorderType:a?StereoAudioRecorder:null},"undefined"==typeof l.sampleRate&&delete l.sampleRate,i=RecordRTC(d.stream,r),o=RecordRTC(d.stream,{type:"video",disableLogs:l.disableLogs,canvas:{width:l.canvas_width,height:l.canvas_height},getNativeBlob:!0,frameInterval:"undefined"!=typeof l.frameInterval?parseInt(l.frameInterval):20}),p&&(o.setRecordingDuration(p).onRecordingStopped(function(e){d.stop(e)}),i.setRecordingDuration(p).onRecordingStopped(function(e){d.stop(e)})),o.initRecorder(function(){i.initRecorder(function(){i.startRecording(),o.startRecording(),t()})}),d.RTCinst=[i,o];else{var r={type:c,mimeType:"video/"+l.videoFormat,disableLogs:l.disableLogs,canvas:{width:l.canvas_width,height:l.canvas_height},getNativeBlob:!0,frameInterval:"undefined"!=typeof l.frameInterval?parseInt(l.frameInterval):20};if("audio"==c&&e.extend(r,{mimeType:"audio/"+l.audioFormat,bufferSize:parseInt(l.bufferSize),sampleRate:parseInt(l.sampleRate),leftChannel:l.leftChannel,recorderType:a?StereoAudioRecorder:null}),"gif"==c&&(r.frameRate=l.frameRate,r.quality=l.quality),d.RTCinst=RecordRTC(d.stream,r),p&&d.RTCinst.setRecordingDuration(p).onRecordingStopped(function(e){d.stop(e)}),d.RTCinst.startRecording(),"gif"==c){d.RTCinst.pauseRecording();var g,u,m=new Date,v=setInterval(function(){u=new Date,g=parseInt((u-m)/1e3),n(d.$previewEl[0])&&(setTimeout(function(){d.RTCinst.resumeRecording(),t()},250),clearInterval(v)),g>5&&alert(l.text.webcam_crashed_alert)},20)}else t()}},l=function(e){var t,a,r=this,i=r.settings.streamType,n=r.$previewEl[0],s=o.call(r)||{},d=s.blob,l=e||"",g=r.$element.find(".msr-preview"),u="removeClass";if("image"==i)r.stream&&(t=document.createElement("canvas"),t.width=n.videoWidth||n.clientWidth,t.height=n.videoHeight||n.clientHeight,a=t.getContext("2d"),a.drawImage(n,0,0,t.width,t.height),l=t.toDataURL("image/jpeg"),r.recordedData=r._dataURItoBlob(l),r.$element.triggerHandler("recording_ended.recorder")),r.$postviewEl.css("display","")[0].src=l;else{if(n.pause(),n.src="",n.srcObject=null,n.muted=!1,n.removeAttribute("muted"),"gif"==i){var m=r.$postviewEl.css("display","")[0];m.src="",m.src=l}else n.src=d?URL.createObjectURL(d):l,n.setAttribute("controls","controls"),n.controls=!0,d&&n.play();n.onended=function(){n.pause()},d?(r.recordedData=d,r.$element.triggerHandler("recording_ended.recorder")):delete r.recordedData}l&&""!=l||(u="addClass"),g[u]("empty-data"),p.call(r),c.call(r)},c=function(){var e,t,a,r,i=this,n=i.settings,s=i.recordedData,o=i.$uploadstatus;if(s)return"function"==typeof n.uploader?void n.uploader(s):void(n.flowOpts&&"undefined"!=typeof Flow&&(e=new Flow(n.flowOpts),s.name=n.filename||"recorded_data",e.addFile(s),e.upload(),o.find(".progress, .progress-bar").addClass("active").css("cursor","").removeClass("progress-bar-success bar-success progress-bar-danger bar-danger"),o.css("display",""),i.$element.triggerHandler("upload_start.recorder"),i.isUploading=!0,i.uploadCompleted=!1,t=function(t){i.$element.triggerHandler("upload_progress.recorder",t);var a=n.text.upload_speed+i._humanize(t.averageSpeed)+"/s "+i._timeToString(1e3*t.timeRemaining())+n.text.time_remaining;o.find(".txt-info").html(a).css("display",""),o.find(".progress-bar").css({width:Math.floor(100*e.progress())+"%"})},"function"==typeof n.onFileProgress&&(t=n.onFileProgress),e.on("fileProgress",t),a=function(e,t,a){i.isUploading=!1,i.uploadCompleted=!0,i.$element.triggerHandler("upload_completed.recorder",[e,t,a]),o.find(".progress, .progress-bar").removeClass("active progress-striped").addClass("progress-bar-success bar-success"),o.find(".progress-bar").html(n.text.completed),o.find(".txt-info").css("display","none")},"function"==typeof n.onFileSuccess&&(a=n.onFileSuccess),e.on("fileSuccess",a),r=function(e,t,a){i.isUploading=!1,i.$element.triggerHandler("upload_error.recorder",[e,t,a]),o.find(".progress, .progress-bar").removeClass("active progress-striped").addClass("progress-bar-danger bar-danger"),o.find(".progress-bar").html(n.text.upload_error).css("cursor","pointer").on("click",function(){c.call(i)}),o.find(".txt-info").css("display","none")},"function"==typeof n.onFileError&&(r=n.onFileError),e.on("fileError",r)))},p=function(){var e=this,t=e.settings;t.streamType;if(e.stream){for(var a=e.stream.getVideoTracks().concat(e.stream.getAudioTracks()),r=0;r<a.length;r++)a[r].stop&&a[r].stop();delete e.stream,e.$element.triggerHandler("stream_stop.recorder")}e.visualizer&&(clearInterval(e.visualizer),e.$visualizer.css("display","none")),e.$element.find(".msr-preview").removeClass("recording"),e.$postviewEl.length?e.$previewEl.css("display","none"):e.$previewEl.css("display","")},g=function(e){var t=this,a=t.settings,i=t.$previewEl[0],n=a.streamType;t.$previewEl.css("display",""),t.$postviewEl.length&&t.$postviewEl.css("display","none"),r(e,function(e){function r(){var e=p,t=20,a=10,r=60;l.getFloatFrequencyData(e),u.clearRect(0,0,g,256),u.beginPath(),u.moveTo(.5,255.5-255.5*t*Math.pow(a,e[0]/t));for(var i=1;i<e.length;i++)u.lineTo(Math.log(i)*r,255.5-255.5*t*Math.pow(a,e[i]/t));u.stroke()}if(t.stream=e,t.$element.triggerHandler("stream_start.recorder"),t.$element.find(".msr-preview").addClass("recording"),i.srcObject=e,i.muted=!0,i.controls=!1,i.removeAttribute("controls"),i.play(),"audio"==n&&t.$visualizer.length){t.$visualizer.css("display",""),window.AudioContext=window.AudioContext||window.webkitAudioContext;var s=t.$visualizer[0],o=new AudioContext,l=o.createAnalyser(),c=o.createGain();c.gain.value=0,l.fftSize=2048;var p=new Float32Array(l.frequencyBinCount);l.connect(c),c.connect(o.destination);var g=l.frequencyBinCount,u=s.getContext("2d");s.width=400,s.height=256,t.visualizer=setInterval(r,20);var m=o.createMediaStreamSource(e);m.connect(l)}d.call(t),"function"==typeof a.onMediaStopped&&(e.onended=a.onMediaStopped)},function(e){console.log(e),"function"==typeof a.onMediaCapturingFailed?a.onMediaCapturingFailed(e):p.call(t)})},u=function(){var t=this,a=t.settings,r=e('<div class="msr-preview empty-data"></div>'),i=a.streamType;switch(t.$postviewEl=[],i){case"video":t.$previewEl=e("<video></video>");break;case"audio":t.$visualizer=e('<canvas style="background-color: #ddd;" class="visualizer"></canvas>').css("display","none"),r.append(t.$visualizer),t.$previewEl=e("<audio></audio>");break;case"gif":case"image":t.$previewEl=e("<video></video>"),t.$postviewEl=e("<img />")}t.$previewEl.css("display","none"),r.append(t.$previewEl),t.$postviewEl.length&&(t.$postviewEl.css("display","none"),r.append(t.$postviewEl)),t.$element.append(r)},m=function(){var t,a=this,r=a.settings,i=e('<div class="msr-panel"></div>'),n=r.streamType,s="image"!=n?r.text.record:r.text.enable_webcam,o="image"!=n?r.text.stop:r.text.take_snapshot;t=e('<div class="btn btn-danger btn-record">'+s+"</div>"),t.on("click",function(){a.record()}).css("display",""),i.append(t),"image"==n||r.limit&&r.disablePause||(t=e('<div class="btn btn-warning btn-pause">'+r.text.pause+"</div>"),t.on("click",function(){a.togglePause()}).css("display","none"),i.append(t),t=e('<div class="btn btn-danger btn-resume">'+r.text.resume+"</div>"),t.on("click",function(){a.togglePause()}).css("display","none"),i.append(t)),r.limit&&r.disableStop||(t=e('<div class="btn btn-primary btn-stop">'+o+"</div>"),t.on("click",function(){a.stop()}).css("display","none"),i.append(t)),a.$element.append(i)},v={init:function(t,a){var r=this;r.$element=t,r.settings=e.extend({},{streamType:"video",audio:!0,showTimer:!0,bufferSize:16384,frameInterval:20,frameRate:100,quality:10,leftChannel:!1,sampleRate:44100,canvas_height:240,canvas_width:320,disableLogs:!0,audioFormat:"",videoFormat:"",limit:0,flowOpts:!1,disableStop:!1,disablePause:!1,text:{webcam_crashed_alert:"webcam not working, please close and open again the browser",enable_webcam:"Enable webcam",take_snapshot:"Take snapshot",time_remaining:" time remaining",upload_speed:"upload speed: ",upload_error:"Upload error, click here to retry",completed:"upload completed",remaining_recording:"Remaining recording time ",record:"Record",pause:"Pause",resume:"Resume",stop:"Stop"}},a);var r=this,i=r.settings;i.streamType=i.streamType.trim().toLowerCase(),i.streamType=/(audio|video|gif|image)/i.test(i.streamType)?i.streamType:"stream",i.audioFormat=i.audioFormat.trim().toLowerCase(),i.audioFormat=/(wav|ogg)/i.test(i.audioFormat)?i.audioFormat:"ogg",i.videoFormat=i.videoFormat.trim().toLowerCase(),i.videoFormat=/(webm|mp4)/i.test(i.videoFormat)?i.videoFormat:"webm",u.call(r),i.showTimer&&(r.$timer=e('<div class="msr-timer"></div>'),r.$element.append(r.$timer)),i.showTimer&&(r.$uploadstatus=e('<div class="msr-upload-status"><div class="progress progress-striped active"><div class="bar progress-bar progress-striped active"></div></div><span class="txt-info"></span></div>').css("display","none"),r.$element.append(r.$uploadstatus)),m.call(r)},getRecordedData:function(){return this.recordedData},setPreview:function(e){l.call(this,e)},record:function(){var e=this,t=e.settings,a=e.$element.find(".msr-panel"),r=t.streamType;delete e.recordedData,l.call(e),a.length&&(a.find(".btn-pause, .btn-stop").css("display",""),a.find(".btn-record, .btn-resume").css("display","none")),g.call(e,{video:"audio"!=r,audio:"audio"==r||"image"!=r&&"gif"!=r&&t.audio})},togglePause:function(){var e=this,t=(e.settings,e.$element.find(".msr-panel")),a=!0,r="pause",i=".btn-resume";t.length&&(t.find(".btn-stop").css("display",""),t.find(".btn-record, .btn-resume, .btn-pause").css("display","none"));var n=e.RTCinst;e.RTCinst.length||(n=[e.RTCinst]),e.isPaused&&(r="resume",a=!1,i=".btn-pause");for(var o=0;o<n.length;o++){var d=n[o];d[r+"Recording"]&&d[r+"Recording"]()}e.$element.triggerHandler("recording_"+r+"d.recorder"),t.find(i).css("display",""),e.isPaused=a,s.call(e)},stop:function(e){var t=this,a=t.settings,r=t.$element.find(".msr-panel"),i=t.RTCinst;return r.length&&(r.find(".btn-record").css("display",""),r.find(".btn-resume, .btn-pause, .btn-stop").css("display","none")),s.call(t,!0),t.isPaused?(t.togglePause(),void t.stop()):e||"image"==a.streamType?void l.call(t,e):void(i&&(i=o.call(t),i.stopRecording(function(e){l.call(t,e)})))},_blobToDataURL:function(e,t){var a=new FileReader;a.onload=function(e){t(e.target.result)},a.readAsDataURL(e)},_dataURItoBlob:function(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var a=e.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(t.length),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return new Blob([r],{type:a})},_humanize:function(e){if(0==e)return"0 Byte";var t=["Bytes","KB","MB","GB","TB"],a=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,a),2)+" "+t[a]},_timeToString:function(e){var t,a,r;return e/=1e3,a=e/60|0,t=a/60|0,r=e%60|0,t&&(a-=60*t),t=t<10?"0"+t:t,a=a<10?"0"+a:a,r=r<10?"0"+r:r,("00"==t?"":t+":")+a+":"+r}},f=function(a){var r=this.data(t+"_data");if(r)return"string"==typeof a&&r[a]?r[a].apply(r,Array.prototype.slice.call(arguments,1)):console.log("Method "+a+" does not exist on jQuery."+t);if(!a||"object"==typeof a){for(var i=this.length,n=0;n<i;n++){var s=e(this[n]);r=e.extend({},v),r.init(s,a),s.data(t+"_data",r)}return this}return console.log("jQuery."+t+' is not instantiated. Please call $("selector").'+t+"({options})")};e.fn?e.fn[t]=f:e.prototype[t]=f}(bg);