function selectResult(e,t){if(1==e.length)return e[0].querySelectorAll(t);for(var r=[],i=0;i<e.length;i++){var a=e[i],n=angular.element(a.querySelectorAll(t));r.push.apply(r,n.slice())}return r}var bg=bg||!1;bg||("undefined"!=typeof jQuery?bg=jQuery:"undefined"!=typeof angular&&(bg=angular.element,bg.extend=angular.extend,bg.prototype.hide=function(){for(var e=0;e<this.length;e++)this[e].style.display="none";return this},bg.prototype.show=function(){for(var e=0;e<this.length;e++)this[e].style.display="";return this},bg.prototype.find=function(e){var t=this[0];if(!t||1!==t.nodeType&&9!==t.nodeType||!angular.isString(e))return[];var r=[];if(">"===e.charAt(0)&&(e=":scope "+e),e.indexOf(":visible")>-1){var i=angular.element(selectResult(this,e.split(":visible")[0]));forEach(i,function(e,t){angular.element(e).is(":visible")&&r.push(e)})}else r=selectResult(this,e);return r.length?1==r.length?angular.element(r[0]):angular.element(r):angular.element()})),function(e){"use strict";var t="recorder",r=!(navigator.userAgent.indexOf("Edge")===-1||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob),i=function(e,t,r){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?void navigator.mediaDevices.getUserMedia(e).then(t)["catch"](r):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia?void navigator.getUserMedia(e,t,r):void r("Browser not compatible, sorry!"))},a=function(e){function t(){if(r=1e3*s-(Date.now()-o|0),i.$timer.html('<span class="txt-info">'+n.text.remaining_recording+'</span><span class="time-info">'+i._timeToString(r)+"</span>"),!r)return void a.call(i,!0)}var r,i=this,n=i.settings,o=i.timerStartedAt?i.timerStartedAt:Date.now(),s=n.limit;return i.timerStoppedAt&&(o+=Date.now()-i.timerStoppedAt),e?(clearInterval(i.timerRunning),i.$timer.hide(),delete i.timerStartedAt,void delete i.timerStoppedAt):i.timerStartedAt&&i.isPaused?(clearInterval(i.timerRunning),void(i.timerStoppedAt=Date.now())):(t(),i.timerRunning=setInterval(t,1e3),void(i.timerStartedAt=o))},n=function(){var e=this,t=(e.settings,!1),r=e.recordRTCInstance;return r.length?(t=r[1]?1:0,r[t]):r},o=function(){var e,t,r,i,a=this,n=a.settings,s=a.getRecordedData(),d=a.$uploadstatus;if(s&&(n.flowOpts&&"undefined"!=typeof Flow||"function"==typeof n.uploader))return n.uploader?void n.uploader(s):void("undefined"!=typeof Flow&&(e=new Flow(n.flowOpts),s.name=n.filename||"recorded_data",e.addFile(s),e.upload(),d.find(".progress, .progress-bar").addClass("active").css("cursor","").removeClass("progress-bar-success bar-success progress-bar-danger bar-danger"),d.show(),a.$element.triggerHandler("upload_start.recorder"),a.isUploading=!0,a.uploadCompleted=!1,t=function(t){a.$element.triggerHandler("upload_progress.recorder",t);var r=n.text.upload_speed+a._humanize(t.averageSpeed)+"/s "+a._timeToString(1e3*t.timeRemaining())+n.text.time_remaining;d.find(".txt-info").show().html(r),d.find(".progress-bar").css({width:Math.floor(100*e.progress())+"%"})},"function"==typeof n.onFileProgress&&(t=n.onFileProgress),e.on("fileProgress",t),r=function(e,t,r){a.isUploading=!1,a.uploadCompleted=!0,a.$element.triggerHandler("upload_completed.recorder",[e,t,r]),d.find(".progress, .progress-bar").removeClass("active progress-striped").addClass("progress-bar-success bar-success"),d.find(".progress-bar").html(n.text.completed),d.find(".txt-info").hide()},"function"==typeof n.onFileSuccess&&(r=n.onFileSuccess),e.on("fileSuccess",r),i=function(e,t,r){a.isUploading=!1,a.$element.triggerHandler("upload_error.recorder",[e,t,r]),d.find(".progress, .progress-bar").removeClass("active progress-striped").addClass("progress-bar-danger bar-danger"),d.find(".progress-bar").html(n.text.upload_error).css("cursor","pointer").on("click",function(){o.call(a)}),d.find(".txt-info").hide()},"function"==typeof n.onFileError&&(i=n.onFileError),e.on("fileError",i)))},s=function(){var e=this,t=e.settings;t.streamType;if(e.stream){for(var r=e.stream.getVideoTracks().concat(e.stream.getAudioTracks()),i=0;i<r.length;i++)r[i].stop&&r[i].stop();e.stream=null}e.$element.triggerHandler("stream_stop.recorder"),e.$postviewEl.length?e.$previewEl.hide():e.$previewEl.show(),e.visualizer&&(clearInterval(e.visualizer),e.$visualizer.hide())},d=function(e){var t=this,r=t.settings,a=t.$previewEl[0],n=r.streamType;t.$previewEl.show(),t.$postviewEl.length&&t.$postviewEl.hide(),i(e,function(e){function i(){var e=c,t=20,r=10,i=60;d.getFloatFrequencyData(e),u.clearRect(0,0,p,256),u.beginPath(),u.moveTo(.5,255.5-255.5*t*Math.pow(r,e[0]/t));for(var a=1;a<e.length;a++)u.lineTo(Math.log(a)*i,255.5-255.5*t*Math.pow(r,e[a]/t));u.stroke()}if(t.stream=e,t.$element.triggerHandler("stream_start.recorder"),a.srcObject=e,a.muted=!0,a.play(),"audio"==n&&t.$visualizer.length){t.$visualizer.show(),window.AudioContext=window.AudioContext||window.webkitAudioContext;var o=t.$visualizer[0],s=new AudioContext,d=s.createAnalyser(),l=s.createGain();l.gain.value=0,d.fftSize=2048;var c=new Float32Array(d.frequencyBinCount);d.connect(l),l.connect(s.destination);var p=d.frequencyBinCount,u=o.getContext("2d");o.width=400,o.height=256,t.visualizer=setInterval(i,20);var g=s.createMediaStreamSource(e);g.connect(d)}t.onMediaCaptured(),"function"==typeof r.onMediaStopped&&(e.onended=r.onMediaStopped)},function(e){"function"==typeof r.onMediaCapturingFailed&&r.onMediaCapturingFailed(e)})},l=function(){var t=this,r=t.settings,i=e('<div class="msr-preview"></div>'),a=r.streamType;switch(t.$postviewEl=[],a){case"video":case"gif":t.$previewEl=e("<video></video>");break;case"audio":t.$visualizer=e('<canvas style="background-color: #ddd;" class="visualizer"></canvas>').hide(),i.append(t.$visualizer),t.$previewEl=e("<audio></audio>");break;case"image":t.$previewEl=e("<video></video>"),t.$postviewEl=e("<img />")}t.$previewEl.hide(),i.append(t.$previewEl),t.$postviewEl.length&&(t.$postviewEl.hide(),i.append(t.$postviewEl)),t.$element.append(i)},c=function(){var t,r=this,i=r.settings,a=e('<div class="msr-panel"></div>'),n=i.streamType,o="image"!=n?i.text.record:i.text.enable_webcam,s="image"!=n?i.text.stop:i.text.take_snapshot;t=e('<div class="btn btn-danger btn-record">'+o+"</div>"),t.on("click",function(){r.record()}).show(),a.append(t),"image"==n||i.limit&&i.disablePause||(t=e('<div class="btn btn-warning btn-pause">'+i.text.pause+"</div>"),t.on("click",function(){r.togglePause()}).hide(),a.append(t),t=e('<div class="btn btn-danger btn-resume">'+i.text.resume+"</div>"),t.on("click",function(){r.togglePause()}).hide(),a.append(t)),i.limit&&i.disableStop||(t=e('<div class="btn btn-primary btn-stop">'+s+"</div>"),t.on("click",function(){r.stop()}).hide(),a.append(t)),r.$element.append(a)},p={init:function(t,r){var i=this;i.$element=t,i.settings=e.extend({},{streamType:"video",audio:!0,showTimer:!0,bufferSize:16384,frameInterval:20,leftChannel:!1,sampleRate:44100,canvas_height:240,canvas_width:320,disableLogs:!0,audioFormat:"",videoFormat:"",limit:0,flowOpts:!1,disableStop:!1,disablePause:!1,text:{enable_webcam:"Enable webcam",take_snapshot:"Take snapshot",time_remaining:" time remaining",upload_speed:"upload speed: ",upload_error:"Upload error, click here to retry",completed:"upload completed",remaining_recording:"Remaining recording time ",record:"Record",pause:"Pause",resume:"Resume",stop:"Stop"}},r);var i=this,a=i.settings;a.streamType=a.streamType.trim().toLowerCase(),a.streamType=/(audio|video|gif|image)/i.test(a.streamType)?a.streamType:"stream",a.audioFormat=a.audioFormat.trim().toLowerCase(),a.audioFormat=/(wav|ogg)/i.test(a.audioFormat)?a.audioFormat:"ogg",a.videoFormat=a.videoFormat.trim().toLowerCase(),a.videoFormat=/(webm|mp4)/i.test(a.videoFormat)?a.videoFormat:"webm",l.call(i),a.showTimer&&(i.$timer=e('<div class="msr-timer"></div>'),i.$element.append(i.$timer)),a.showTimer&&(i.$uploadstatus=e('<div class="msr-upload-status"><div class="progress progress-striped active"><div class="bar progress-bar progress-striped active"></div></div><span class="txt-info"></span></div>').hide(),i.$element.append(i.$uploadstatus)),c.call(i)},getRecordedData:function(){return this.recordedData},record:function(){var e,t=this,i=t.settings,l=t.$element.find(".msr-panel"),c=i.streamType,p=t.$previewEl[0];switch(delete t.recordedData,l.length&&(l.find(".btn-pause, .btn-stop").show(),l.find(".btn-record, .btn-resume").hide()),t.recordingEnded=function(e){var r=n.call(t),i="poster";p.src=null,p.srcObject=null,p.muted=!1,p.removeAttribute("muted"),p.pause(),"gif"!=c&&(i="src",p.controls=!0,p.play()),p[i]=e,p.onended=function(){p.pause(),p[i]=URL.createObjectURL(r.blob)},t.recordedData=r.blob,t.$element.triggerHandler("recording_ended.recorder"),s.call(t),o.call(t)},c){case"video":case"gif":t.onMediaCaptured=function(){if("video"==c&&i.audio&&"undefined"==typeof MediaRecorder){var e={type:"audio",bufferSize:parseInt(i.bufferSize),sampleRate:parseInt(i.sampleRate),leftChannel:i.leftChannel,disableLogs:i.disableLogs,recorderType:r?StereoAudioRecorder:null};"undefined"==typeof i.sampleRate&&delete i.sampleRate;var n=RecordRTC(t.stream,e),o=RecordRTC(t.stream,{type:"video",disableLogs:i.disableLogs,canvas:{width:i.canvas_width,height:i.canvas_height},getNativeBlob:!0,frameInterval:"undefined"!=typeof i.frameInterval?parseInt(i.frameInterval):20});i.limit&&(o.setRecordingDuration(1e3*i.limit).onRecordingStopped(function(e){t.stop(e)}),n.setRecordingDuration(1e3*i.limit).onRecordingStopped(function(e){t.stop(e)})),o.initRecorder(function(){n.initRecorder(function(){n.startRecording(),o.startRecording(),t.$element.triggerHandler("recording_started.recorder"),i.showTimer&&a.call(t)})}),t.recordRTCInstance=[n,o]}else t.recordRTCInstance=RecordRTC(t.stream,{type:c,mimeType:"video/"+i.videoFormat,disableLogs:i.disableLogs,canvas:{width:i.canvas_width,height:i.canvas_height},getNativeBlob:!0,frameInterval:"undefined"!=typeof i.frameInterval?parseInt(i.frameInterval):20}),i.limit&&t.recordRTCInstance.setRecordingDuration(1e3*i.limit).onRecordingStopped(function(e){t.stop(e)}),t.recordRTCInstance.startRecording(),t.$element.triggerHandler("recording_started.recorder"),i.showTimer&&a.call(t)},e={video:!0},i.audio&&(e.audio=!0),d.call(t,e);break;case"audio":t.onMediaCaptured=function(){t.recordRTCInstance=RecordRTC(t.stream,{type:c,mimeType:"audio/"+i.audioFormat,bufferSize:parseInt(i.bufferSize),sampleRate:parseInt(i.sampleRate),leftChannel:i.leftChannel,disableLogs:i.disableLogs,recorderType:r?StereoAudioRecorder:null}),t.$previewEl.hide(),i.limit&&t.recordRTCInstance.setRecordingDuration(1e3*i.limit).onRecordingStopped(function(e){t.stop(e)}),t.recordRTCInstance.startRecording(),t.$element.triggerHandler("recording_started.recorder"),i.showTimer&&a.call(t)},e={audio:!0},d.call(t,e);break;case"image":t.onMediaCaptured=function(){},t.recordingEnded=function(e){var r=document.createElement("canvas");r.width=p.videoWidth||p.clientWidth,r.height=p.videoHeight||p.clientHeight;var i=r.getContext("2d");i.drawImage(p,0,0,r.width,r.height),t.recordedData=r.toDataURL("image/jpeg"),t.$postviewEl.show()[0].src=t.recordedData,t.recordedData=t._dataURItoBlob(t.recordedData),t.$element.triggerHandler("recording_ended.recorder"),s.call(t),o.call(t)},e={video:!0},d.call(t,e)}},togglePause:function(){var e=this,t=(e.settings,e.$element.find(".msr-panel")),r=!0,i="pause",n=".btn-resume";t.length&&(t.find(".btn-stop").show(),t.find(".btn-record, .btn-resume, .btn-pause").hide());var o=e.recordRTCInstance;e.recordRTCInstance.length||(o=[e.recordRTCInstance]),e.isPaused&&(i="resume",r=!1,n=".btn-pause");for(var s=0;s<o.length;s++){var d=o[s];d[i+"Recording"]&&d[i+"Recording"]()}e.$element.triggerHandler("recording_"+i+"d.recorder"),t.find(n).show(),e.isPaused=r,a.call(e)},stop:function(e){var t=this,r=t.settings,i=t.$element.find(".msr-panel"),o=t.recordRTCInstance;if(i.length&&(i.find(".btn-record").show(),i.find(".btn-resume, .btn-pause, .btn-stop").hide()),a.call(t,!0),"image"==r.streamType)return void t.recordingEnded(e);if(o){if(t.isPaused)return t.togglePause(),void t.stop();if(e)return void t.recordingEnded(e);o=n.call(t),o.stopRecording(function(e){t.recordingEnded(e)})}},_blobToDataURL:function(e,t){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsDataURL(e)},_dataURItoBlob:function(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var r=e.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(t.length),a=0;a<t.length;a++)i[a]=t.charCodeAt(a);return new Blob([i],{type:r})},_humanize:function(e){if(0==e)return"0 Byte";var t=["Bytes","KB","MB","GB","TB"],r=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,r),2)+" "+t[r]},_timeToString:function(e){var t,r,i;return e/=1e3,r=e/60|0,t=r/60|0,i=e%60|0,t&&(r-=60*t),t=t<10?"0"+t:t,r=r<10?"0"+r:r,i=i<10?"0"+i:i,("00"==t?"":t+":")+r+":"+i}},u=function(r){var i=this.data(t+"_data");if(i)return"string"==typeof r&&i[r]?i[r].apply(i,Array.prototype.slice.call(arguments,1)):console.log("Method "+r+" does not exist on jQuery."+t);if(!r||"object"==typeof r){for(var a=this.length,n=0;n<a;n++){var o=e(this[n]);i=e.extend({},p),i.init(o,r),o.data(t+"_data",i)}return this}return console.log("jQuery."+t+' is not instantiated. Please call $("selector").'+t+"({options})")};e.fn?e.fn[t]=u:e.prototype[t]=u}(bg);