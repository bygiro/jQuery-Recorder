function selectResult(e,t){if(1==e.length)return e[0].querySelectorAll(t);for(var r=[],a=0;a<e.length;a++){var i=e[a],n=angular.element(i.querySelectorAll(t));r.push.apply(r,n.slice())}return r}var bg=bg||!1;bg||("undefined"!=typeof jQuery?bg=jQuery:"undefined"!=typeof angular&&(bg=angular.element,bg.extend=angular.extend,bg.prototype.find=function(e){var t=this[0];if(!t||1!==t.nodeType&&9!==t.nodeType||!angular.isString(e))return[];var r=[];if(">"===e.charAt(0)&&(e=":scope "+e),e.indexOf(":visible")>-1){var a=angular.element(selectResult(this,e.split(":visible")[0]));forEach(a,function(e,t){angular.element(e).is(":visible")&&r.push(e)})}else r=selectResult(this,e);return r.length?1==r.length?angular.element(r[0]):angular.element(r):angular.element()})),function(e){"use strict";var t="recorder",r=!(navigator.userAgent.indexOf("Edge")===-1||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob),a=function(e,t,r){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?void navigator.mediaDevices.getUserMedia(e).then(t)["catch"](r):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia?void navigator.getUserMedia(e,t,r):void r("Browser not compatible, sorry!"))},i=function(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var r=e.split(",")[0].split(":")[1].split(";")[0],a=new Uint8Array(t.length),i=0;i<t.length;i++)a[i]=t.charCodeAt(i);return new Blob([a],{type:r})},n=function(e){if(0==e)return"0 Byte";var t=["Bytes","KB","MB","GB","TB"],r=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,r),2)+" "+t[r]},o=function(e){var t,r,a;return e/=1e3,r=e/60|0,t=r/60|0,a=e%60|0,t&&(r-=60*t),t=t<10?"0"+t:t,r=r<10?"0"+r:r,a=a<10?"0"+a:a,("00"==t?"":t+":")+r+":"+a},s=function(e){function t(){if(r=1e3*d-(Date.now()-n|0),a.$timer.html('<span class="txt-info">'+i.text.remaining_recording+'</span><span class="time-info">'+o(r)+"</span>"),!r)return void s.call(a,!0)}var r,a=this,i=a.settings,n=a.timerStartedAt?a.timerStartedAt:Date.now(),d=i.limit;return a.timerStoppedAt&&(n+=Date.now()-a.timerStoppedAt),e?(clearInterval(a.timerRunning),a.$timer.hide(),delete a.timerStartedAt,void delete a.timerStoppedAt):a.timerStartedAt&&a.isPaused?(clearInterval(a.timerRunning),void(a.timerStoppedAt=Date.now())):(t(),a.timerRunning=setInterval(t,1e3),void(a.timerStartedAt=n))},d=function(){var e=this,t=(e.settings,!1),r=e.recordRTCInstance;return r.length?(t=r[1]?1:0,r[t]):r},l=function(){var e,t,r,a=this,i=a.settings,s=a.getRecordedData(),d=a.$uploadstatus;if(s&&(i.flowOpts&&"undefined"!=typeof Flow||"function"==typeof i.uploader))return i.uploader?void i.uploader(s):void("undefined"!=typeof Flow&&(e=new Flow(i.flowOpts),s.name=i.filename||"recorded_data",e.addFile(s),e.upload(),d.find(".progress, .progress-bar").addClass("active").removeClass("progress-bar-success bar-success"),d.show(),a.$element.triggerHandler("upload_start.recorder"),t=function(t){a.$element.triggerHandler("upload_progress.recorder",t);var r=i.text.upload_speed+n(t.averageSpeed)+"/s "+o(1e3*t.timeRemaining())+i.text.time_remaining;d.find(".txt-info").show().html(r),d.find(".progress-bar").css({width:Math.floor(100*e.progress())+"%"})},"function"==typeof i.onFileProgress&&(t=i.onFileProgress),e.on("fileProgress",t),r=function(e,t,r){a.$element.triggerHandler("upload_completed.recorder",[e,t,r]),d.find(".progress, .progress-bar").removeClass("active progress-striped").addClass("progress-bar-success bar-success"),d.find(".progress-bar").html(i.text.completed),d.find(".txt-info").hide()},"function"==typeof i.onFileSuccess&&(r=i.onFileSuccess),e.on("fileSuccess",r)))},c=function(){var e=this,t=e.settings;t.streamType;if(e.stream){for(var r=e.stream.getVideoTracks().concat(e.stream.getAudioTracks()),a=0;a<r.length;a++)r[a].stop&&r[a].stop();e.stream=null}e.$element.triggerHandler("stream_stop.recorder"),e.$postviewEl.length?e.$previewEl.hide():e.$previewEl.show(),e.visualizer&&(clearInterval(e.visualizer),e.$visualizer.hide())},p=function(e){var t=this,r=t.settings,i=t.$previewEl[0],n=r.streamType;t.$previewEl.show(),t.$postviewEl.length&&t.$postviewEl.hide(),a(e,function(e){function a(){var e=c,t=20,r=10,a=60;d.getFloatFrequencyData(e),u.clearRect(0,0,p,256),u.beginPath(),u.moveTo(.5,255.5-255.5*t*Math.pow(r,e[0]/t));for(var i=1;i<e.length;i++)u.lineTo(Math.log(i)*a,255.5-255.5*t*Math.pow(r,e[i]/t));u.stroke()}if(t.stream=e,t.$element.triggerHandler("stream_start.recorder"),i.srcObject=e,i.muted=!0,i.play(),"audio"==n&&t.$visualizer.length){t.$visualizer.show(),window.AudioContext=window.AudioContext||window.webkitAudioContext;var o=t.$visualizer[0],s=new AudioContext,d=s.createAnalyser(),l=s.createGain();l.gain.value=0,d.fftSize=2048;var c=new Float32Array(d.frequencyBinCount);d.connect(l),l.connect(s.destination);var p=d.frequencyBinCount,u=o.getContext("2d");o.width=400,o.height=256,t.visualizer=setInterval(a,20);var g=s.createMediaStreamSource(e);g.connect(d)}t.onMediaCaptured(),"function"==typeof r.onMediaStopped&&(e.onended=r.onMediaStopped)},function(e){"function"==typeof r.onMediaCapturingFailed&&r.onMediaCapturingFailed(e)})},u=function(){var t=this,r=t.settings,a=e('<div class="msr-preview"></div>'),i=r.streamType;switch(t.$postviewEl=[],i){case"video":case"gif":t.$previewEl=e("<video></video>");break;case"audio":t.$visualizer=e('<canvas style="background-color: #ddd;" class="visualizer"></canvas>').hide(),a.append(t.$visualizer),t.$previewEl=e("<audio></audio>");break;case"image":t.$previewEl=e("<video></video>"),t.$postviewEl=e("<img />")}t.$previewEl.hide(),a.append(t.$previewEl),t.$postviewEl.length&&(t.$postviewEl.hide(),a.append(t.$postviewEl)),t.$element.append(a)},g=function(){var t,r=this,a=r.settings,i=e('<div class="msr-panel"></div>'),n=a.streamType,o="image"!=n?a.text.record:a.text.enable_webcam,s="image"!=n?a.text.stop:a.text.take_snapshot;t=e('<div class="btn btn-danger btn-record">'+o+"</div>"),t.on("click",function(){r.record()}).show(),i.append(t),"image"==n||a.limit&&a.disablePause||(t=e('<div class="btn btn-warning btn-pause">'+a.text.pause+"</div>"),t.on("click",function(){r.togglePause()}).hide(),i.append(t),t=e('<div class="btn btn-danger btn-resume">'+a.text.resume+"</div>"),t.on("click",function(){r.togglePause()}).hide(),i.append(t)),a.limit&&a.disableStop||(t=e('<div class="btn btn-primary btn-stop">'+s+"</div>"),t.on("click",function(){r.stop()}).hide(),i.append(t)),r.$element.append(i)},m={init:function(t,r){var a=this;a.$element=t,a.settings=e.extend({},{streamType:"video",audio:!0,showTimer:!0,bufferSize:16384,frameInterval:20,leftChannel:!1,sampleRate:44100,canvas_height:240,canvas_width:320,disableLogs:!0,audioFormat:"",videoFormat:"",limit:0,flowOpts:!1,disableStop:!1,disablePause:!1,text:{enable_webcam:"Enable webcam",take_snapshot:"Take snapshot",time_remaining:" time remaining",upload_speed:"upload speed: ",completed:"upload completed",remaining_recording:"Remaining recording time ",record:"Record",pause:"Pause",resume:"Resume",stop:"Stop"}},r);var a=this,i=a.settings;i.streamType=i.streamType.trim().toLowerCase(),i.streamType=/(audio|video|gif|image)/i.test(i.streamType)?i.streamType:"stream",i.audioFormat=i.audioFormat.trim().toLowerCase(),i.audioFormat=/(wav|ogg)/i.test(i.audioFormat)?i.audioFormat:"ogg",i.videoFormat=i.videoFormat.trim().toLowerCase(),i.videoFormat=/(webm|mp4)/i.test(i.videoFormat)?i.videoFormat:"webm",u.call(a),i.showTimer&&(a.$timer=e('<div class="msr-timer"></div>'),a.$element.append(a.$timer)),i.showTimer&&(a.$uploadstatus=e('<div class="msr-upload-status"><div class="progress progress-striped active"><div class="bar progress-bar progress-striped active"></div></div><span class="txt-info"></span></div>').hide(),a.$element.append(a.$uploadstatus)),g.call(a)},getRecordedData:function(){return this.recordedData},record:function(){var e,t=this,a=t.settings,n=t.$element.find(".msr-panel"),o=a.streamType,u=t.$previewEl[0];switch(delete t.recordedData,n.length&&(n.find(".btn-pause, .btn-stop").show(),n.find(".btn-record, .btn-resume").hide()),t.recordingEnded=function(e){var r=d.call(t),a="poster";u.src=null,u.srcObject=null,u.muted=!1,u.removeAttribute("muted"),u.pause(),"gif"!=o&&(a="src",u.controls=!0,u.play()),u[a]=e,u.onended=function(){u.pause(),u[a]=URL.createObjectURL(r.blob)},t.recordedData=r.blob,t.$element.triggerHandler("recording_ended.recorder"),c.call(t),l.call(t)},o){case"video":case"gif":t.onMediaCaptured=function(){if("video"==o&&a.audio&&"undefined"==typeof MediaRecorder){var e={type:"audio",bufferSize:parseInt(a.bufferSize),sampleRate:parseInt(a.sampleRate),leftChannel:a.leftChannel,disableLogs:a.disableLogs,recorderType:r?StereoAudioRecorder:null};"undefined"==typeof a.sampleRate&&delete a.sampleRate;var i=RecordRTC(t.stream,e),n=RecordRTC(t.stream,{type:"video",disableLogs:a.disableLogs,canvas:{width:a.canvas_width,height:a.canvas_height},getNativeBlob:!0,frameInterval:"undefined"!=typeof a.frameInterval?parseInt(a.frameInterval):20});a.limit&&(n.setRecordingDuration(1e3*a.limit).onRecordingStopped(function(e){t.stop(e)}),i.setRecordingDuration(1e3*a.limit).onRecordingStopped(function(e){t.stop(e)})),n.initRecorder(function(){i.initRecorder(function(){i.startRecording(),n.startRecording(),t.$element.triggerHandler("recording_started.recorder"),a.showTimer&&s.call(t)})}),t.recordRTCInstance=[i,n]}else t.recordRTCInstance=RecordRTC(t.stream,{type:o,mimeType:"video/"+a.videoFormat,disableLogs:a.disableLogs,canvas:{width:a.canvas_width,height:a.canvas_height},getNativeBlob:!0,frameInterval:"undefined"!=typeof a.frameInterval?parseInt(a.frameInterval):20}),a.limit&&t.recordRTCInstance.setRecordingDuration(1e3*a.limit).onRecordingStopped(function(e){t.stop(e)}),t.recordRTCInstance.startRecording(),t.$element.triggerHandler("recording_started.recorder"),a.showTimer&&s.call(t)},e={video:!0},a.audio&&(e.audio=!0),p.call(t,e);break;case"audio":t.onMediaCaptured=function(){t.recordRTCInstance=RecordRTC(t.stream,{type:o,mimeType:"audio/"+a.audioFormat,bufferSize:parseInt(a.bufferSize),sampleRate:parseInt(a.sampleRate),leftChannel:a.leftChannel,disableLogs:a.disableLogs,recorderType:r?StereoAudioRecorder:null}),t.$previewEl.hide(),a.limit&&t.recordRTCInstance.setRecordingDuration(1e3*a.limit).onRecordingStopped(function(e){t.stop(e)}),t.recordRTCInstance.startRecording(),t.$element.triggerHandler("recording_started.recorder"),a.showTimer&&s.call(t)},e={audio:!0},p.call(t,e);break;case"image":t.onMediaCaptured=function(){},t.recordingEnded=function(e){var r=document.createElement("canvas");r.width=u.videoWidth||u.clientWidth,r.height=u.videoHeight||u.clientHeight;var a=r.getContext("2d");a.drawImage(u,0,0,r.width,r.height),t.recordedData=r.toDataURL("image/jpeg"),t.$postviewEl.show()[0].src=t.recordedData,t.recordedData=i(t.recordedData),t.$element.triggerHandler("recording_ended.recorder"),c.call(t),l.call(t)},e={video:!0},p.call(t,e)}},togglePause:function(){var e=this,t=(e.settings,e.$element.find(".msr-panel")),r=!0,a="pause",i=".btn-resume";t.length&&(t.find(".btn-stop").show(),t.find(".btn-record, .btn-resume, .btn-pause").hide());var n=e.recordRTCInstance;e.recordRTCInstance.length||(n=[e.recordRTCInstance]),e.isPaused&&(a="resume",r=!1,i=".btn-pause");for(var o=0;o<n.length;o++){var d=n[o];d[a+"Recording"]&&d[a+"Recording"]()}e.$element.triggerHandler("recording_"+a+"d.recorder"),t.find(i).show(),e.isPaused=r,s.call(e)},stop:function(e){var t=this,r=t.settings,a=t.$element.find(".msr-panel"),i=t.recordRTCInstance;if(a.length&&(a.find(".btn-record").show(),a.find(".btn-resume, .btn-pause, .btn-stop").hide()),s.call(t,!0),"image"==r.streamType)return void t.recordingEnded(e);if(i){if(t.isPaused)return t.togglePause(),void t.stop();if(e)return void t.recordingEnded(e);i=d.call(t),i.stopRecording(function(e){t.recordingEnded(e)})}}},v=function(r){var a=this.data(t+"_data");if(a)return"string"==typeof r&&a[r]?a[r].apply(a,Array.prototype.slice.call(arguments,1)):console.log("Method "+r+" does not exist on jQuery."+t);if(!r||"object"==typeof r){for(var i=this.length,n=0;n<i;n++){var o=e(this[n]);a=e.extend({},m),a.init(o,r),o.data(t+"_data",a)}return this}return console.log("jQuery."+t+' is not instantiated. Please call $("selector").'+t+"({options})")};e.fn?e.fn[t]=v:e.prototype[t]=v}(bg);