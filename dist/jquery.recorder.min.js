function selectResult(e,t){if(1==e.length)return e[0].querySelectorAll(t);for(var i=[],a=0;a<e.length;a++){var r=e[a],n=angular.element(r.querySelectorAll(t));i.push.apply(i,n.slice())}return i}var bg=bg||!1;bg||("undefined"!=typeof jQuery?bg=jQuery:"undefined"!=typeof angular&&(bg=angular.element,bg.extend=angular.extend,bg.prototype.find=function(e){var t=this[0];if(!t||1!==t.nodeType&&9!==t.nodeType||!angular.isString(e))return[];var i=[];if(">"===e.charAt(0)&&(e=":scope "+e),e.indexOf(":visible")>-1){var a=angular.element(selectResult(this,e.split(":visible")[0]));forEach(a,function(e,t){angular.element(e).is(":visible")&&i.push(e)})}else i=selectResult(this,e);return i.length?1==i.length?angular.element(i[0]):angular.element(i):angular.element()})),function(e){"use strict";var t="recorder",i=function(e,t,i){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?void navigator.mediaDevices.getUserMedia(e).then(t)["catch"](i):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia?void navigator.getUserMedia(e,t,i):void i("Browser not compatible, sorry!"))},a=function(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var i=e.split(",")[0].split(":")[1].split(";")[0],a=new Uint8Array(t.length),r=0;r<t.length;r++)a[r]=t.charCodeAt(r);return new Blob([a],{type:i})},r=function(e){if(0==e)return"0 Byte";var t=["Bytes","KB","MB","GB","TB"],i=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.round(e/Math.pow(1024,i),2)+" "+t[i]},n=function(e){var t,i,a;return e/=1e3,i=e/60|0,t=i/60|0,a=e%60|0,t&&(i-=60*t),t=t<10?"0"+t:t,i=i<10?"0"+i:i,a=a<10?"0"+a:a,("00"==t?"":t+":")+i+":"+a},o=function(e){function t(){if(i=1e3*d-(Date.now()-s|0),a.$timer.html('<span class="txt-info">'+r.text.remaining_recording+'</span><span class="time-info">'+n(i)+"</span>"),!i)return void o.call(a,!0)}var i,a=this,r=a.settings,s=a.timerStartedAt?a.timerStartedAt:Date.now(),d=r.limit;return a.timerStoppedAt&&(s+=Date.now()-a.timerStoppedAt),e?(clearInterval(a.timerRunning),a.$timer.hide(),delete a.timerStartedAt,void delete a.timerStoppedAt):a.timerStartedAt&&a.isPaused?(clearInterval(a.timerRunning),void(a.timerStoppedAt=Date.now())):(t(),a.timerRunning=setInterval(t,1e3),void(a.timerStartedAt=s))},s=function(){var e=this,t=(e.settings,!1),i=e.recordRTCInstance;return i.length?(t=i[1]?1:0,i[t]):i},d=function(){var e,t=this,i=t.settings,a=t.getRecordedData(),o=t.$uploadstatus;i.flowOpts&&"undefined"!=typeof Flow&&a&&(e=new Flow(i.flowOpts),a.name=i.filename||"recorded_data",e.addFile(a),e.upload(),o.find(".progress, .progress-bar").addClass("active").removeClass("progress-bar-success bar-success"),o.show(),e.on("fileProgress",function(t){var a=i.text.upload_speed+r(t.averageSpeed)+"/s "+n(1e3*t.timeRemaining())+i.text.time_remaining;o.find(".txt-info").show().html(a),o.find(".progress-bar").css({width:Math.floor(100*e.progress())+"%"})}),e.on("fileSuccess",function(e,t,a){o.find(".progress, .progress-bar").removeClass("active progress-striped").addClass("progress-bar-success bar-success"),o.find(".progress-bar").html(i.text.completed),o.find(".txt-info").hide()}))},l=function(){var e=this,t=e.settings;t.streamType;if(e.stream){for(var i=e.stream.getVideoTracks().concat(e.stream.getAudioTracks()),a=0;a<i.length;a++)i[a].stop&&i[a].stop();e.stream=null}e.$postviewEl.length?e.$previewEl.hide():e.$previewEl.show(),e.visualizer&&(clearInterval(e.visualizer),e.$visualizer.hide())},c=function(e){var t=this,a=t.settings,r=t.$previewEl[0],n=a.streamType;t.$previewEl.show(),t.$postviewEl.length&&t.$postviewEl.hide(),i(e,function(e){function i(){var e=l,t=20,i=10,a=60;s.getFloatFrequencyData(e),p.clearRect(0,0,c,256),p.beginPath(),p.moveTo(.5,255.5-255.5*t*Math.pow(i,e[0]/t));for(var r=1;r<e.length;r++)p.lineTo(Math.log(r)*a,255.5-255.5*t*Math.pow(i,e[r]/t));p.stroke()}if(t.stream=e,r.srcObject=e,r.muted=!0,r.play(),"audio"==n&&t.$visualizer.length){t.$visualizer.show(),window.AudioContext=window.AudioContext||window.webkitAudioContext;var a=t.$visualizer[0],o=new AudioContext,s=o.createAnalyser(),d=o.createGain();d.gain.value=0,s.fftSize=2048;var l=new Float32Array(s.frequencyBinCount);s.connect(d),d.connect(o.destination);var c=s.frequencyBinCount,p=a.getContext("2d");a.width=400,a.height=256,t.visualizer=setInterval(i,20);var u=o.createMediaStreamSource(e);u.connect(s)}t.onMediaCaptured(),e.onended=function(){t.onMediaStopped()}},function(e){t.onMediaCapturingFailed(e)})},p=function(){var t=this,i=t.settings,a=e('<div class="msr-preview"></div>'),r=i.streamType;switch(t.$postviewEl=[],r){case"video":case"gif":t.$previewEl=e("<video></video>");break;case"audio":t.$visualizer=e('<canvas style="background-color: #ddd;" class="visualizer"></canvas>').hide(),a.append(t.$visualizer),t.$previewEl=e("<audio></audio>");break;case"image":t.$previewEl=e("<video></video>"),t.$postviewEl=e("<img />")}t.$previewEl.hide(),a.append(t.$previewEl),t.$postviewEl.length&&(t.$postviewEl.hide(),a.append(t.$postviewEl)),t.$element.append(a)},u=function(){var t,i=this,a=i.settings,r=e('<div class="msr-panel"></div>'),n=a.streamType,o="image"!=n?a.text.record:a.text.enable_webcam,s="image"!=n?a.text.stop:a.text.take_snapshot;t=e('<div class="btn btn-danger btn-record">'+o+"</div>"),t.on("click",function(){i.record()}).show(),r.append(t),"image"==n||a.limit&&a.disablePause||(t=e('<div class="btn btn-warning btn-pause">'+a.text.pause+"</div>"),t.on("click",function(){i.togglePause()}).hide(),r.append(t),t=e('<div class="btn btn-danger btn-resume">'+a.text.resume+"</div>"),t.on("click",function(){i.togglePause()}).hide(),r.append(t)),a.limit&&a.disableStop||(t=e('<div class="btn btn-primary btn-stop">'+s+"</div>"),t.on("click",function(){i.stop()}).hide(),r.append(t)),i.$element.append(r)},g={init:function(t,i){var a=this;a.$element=t,a.settings=e.extend({},{streamType:"video",audio:!0,showTimer:!0,bufferSize:16384,frameInterval:20,leftChannel:!1,sampleRate:44100,canvas_height:240,canvas_width:320,disableLogs:!0,audioFormat:"",videoFormat:"",limit:0,flowOpts:!1,disableStop:!1,disablePause:!1,text:{enable_webcam:"Enable webcam",take_snapshot:"Take snapshot",time_remaining:" time remaining",upload_speed:"upload speed: ",completed:"upload completed",remaining_recording:"Remaining recording time ",record:"Record",pause:"Pause",resume:"Resume",stop:"Stop"}},i);var a=this,r=a.settings;r.streamType=r.streamType.trim().toLowerCase(),r.streamType=/(audio|video|gif|image)/i.test(r.streamType)?r.streamType:"stream",r.audioFormat=r.audioFormat.trim().toLowerCase(),r.audioFormat=/(wav|ogg)/i.test(r.audioFormat)?r.audioFormat:"ogg",r.videoFormat=r.videoFormat.trim().toLowerCase(),r.videoFormat=/(webm|mp4)/i.test(r.videoFormat)?r.videoFormat:"webm",p.call(a),r.showTimer&&(a.$timer=e('<div class="msr-timer"></div>'),a.$element.append(a.$timer)),r.showTimer&&(a.$uploadstatus=e('<div class="msr-upload-status"><div class="progress progress-striped active"><div class="bar progress-bar progress-striped active"></div></div><span class="txt-info"></span></div>').hide(),a.$element.append(a.$uploadstatus)),u.call(a)},getRecordedData:function(){return this.recordedData},record:function(){var e,t=this,i=t.settings,r=t.$element.find(".msr-panel"),n=i.streamType,p=t.$previewEl[0];switch(delete t.recordedData,r.length&&(r.find(".btn-pause, .btn-stop").show(),r.find(".btn-record, .btn-resume").hide()),t.onMediaCapturingFailed=function(e){console.log("media capturing error ")},t.onMediaStopped=function(){console.log("media stopped")},t.recordingEnded=function(e){var i=s.call(t),a="poster";p.src=null,p.srcObject=null,p.muted=!1,p.removeAttribute("muted"),p.pause(),"gif"!=n&&(a="src",p.controls=!0,p.play()),p[a]=e,p.onended=function(){p.pause(),p[a]=URL.createObjectURL(i.blob)},t.recordedData=i.blob,l.call(t),d.call(t)},n){case"video":case"gif":t.onMediaCaptured=function(){if("video"==n&&i.audio&&"undefined"==typeof MediaRecorder){var e={type:"audio",bufferSize:parseInt(i.bufferSize),sampleRate:parseInt(i.sampleRate),leftChannel:i.leftChannel,disableLogs:i.disableLogs,recorderType:DetectRTC.browser.isEdge?StereoAudioRecorder:null};"undefined"==typeof i.sampleRate&&delete i.sampleRate;var a=RecordRTC(t.stream,e),r=RecordRTC(t.stream,{type:"video",disableLogs:i.disableLogs,canvas:{width:i.canvas_width,height:i.canvas_height},getNativeBlob:!0,frameInterval:"undefined"!=typeof i.frameInterval?parseInt(i.frameInterval):20});i.limit&&(r.setRecordingDuration(1e3*i.limit).onRecordingStopped(function(e){t.stop(e)}),a.setRecordingDuration(1e3*i.limit).onRecordingStopped(function(e){t.stop(e)})),r.initRecorder(function(){a.initRecorder(function(){a.startRecording(),r.startRecording(),i.showTimer&&o.call(t)})}),t.recordRTCInstance=[a,r]}else t.recordRTCInstance=RecordRTC(t.stream,{type:n,mimeType:"video/"+i.videoFormat,disableLogs:i.disableLogs,canvas:{width:i.canvas_width,height:i.canvas_height},getNativeBlob:!0,frameInterval:"undefined"!=typeof i.frameInterval?parseInt(i.frameInterval):20}),i.limit&&t.recordRTCInstance.setRecordingDuration(1e3*i.limit).onRecordingStopped(function(e){t.stop(e)}),t.recordRTCInstance.startRecording(),i.showTimer&&o.call(t)},e={video:!0},i.audio&&(e.audio=!0),c.call(t,e);break;case"audio":t.onMediaCaptured=function(){t.recordRTCInstance=RecordRTC(t.stream,{type:n,mimeType:"audio/"+i.audioFormat,bufferSize:parseInt(i.bufferSize),sampleRate:parseInt(i.sampleRate),leftChannel:i.leftChannel,disableLogs:i.disableLogs,recorderType:DetectRTC.browser.isEdge?StereoAudioRecorder:null}),t.$previewEl.hide(),i.limit&&t.recordRTCInstance.setRecordingDuration(1e3*i.limit).onRecordingStopped(function(e){t.stop(e)}),t.recordRTCInstance.startRecording(),i.showTimer&&o.call(t)},e={audio:!0},c.call(t,e);break;case"image":t.onMediaCaptured=function(){},t.recordingEnded=function(e){var i=document.createElement("canvas");i.width=p.videoWidth||p.clientWidth,i.height=p.videoHeight||p.clientHeight;var r=i.getContext("2d");r.drawImage(p,0,0,i.width,i.height),t.recordedData=i.toDataURL("image/jpeg"),t.$postviewEl.show()[0].src=t.recordedData,t.recordedData=a(t.recordedData),l.call(t),d.call(t)},e={video:!0},c.call(t,e)}},togglePause:function(){var e=this,t=(e.settings,e.$element.find(".msr-panel")),i=!0,a="pauseRecording",r=".btn-resume";t.length&&(t.find(".btn-stop").show(),t.find(".btn-record, .btn-resume, .btn-pause").hide());var n=e.recordRTCInstance;e.recordRTCInstance.length||(n=[e.recordRTCInstance]),e.isPaused&&(a="resumeRecording",i=!1,r=".btn-pause");for(var s=0;s<n.length;s++){var d=n[s];d[a]&&d[a]()}t.find(r).show(),e.isPaused=i,o.call(e)},stop:function(e){var t=this,i=t.settings,a=t.$element.find(".msr-panel"),r=t.recordRTCInstance;if(a.length&&(a.find(".btn-record").show(),a.find(".btn-resume, .btn-pause, .btn-stop").hide()),o.call(t,!0),"image"==i.streamType)return void t.recordingEnded(e);if(r){if(t.isPaused)return t.togglePause(),void t.stop();if(e)return void t.recordingEnded(e);r=s.call(t),r.stopRecording(function(e){t.recordingEnded(e)})}}},m=function(i){var a=this.data(t+"_data");if(a)return"string"==typeof i&&a[i]?a[i].apply(a,Array.prototype.slice.call(arguments,1)):console.log("Method "+i+" does not exist on jQuery."+t);if(!i||"object"==typeof i){for(var r=this.length,n=0;n<r;n++){var o=e(this[n]);a=e.extend({},g),a.init(o,i),o.data(t+"_data",a)}return this}return console.log("jQuery."+t+' is not instantiated. Please call $("selector").'+t+"({options})")};e.fn?e.fn[t]=m:e.prototype[t]=m}(bg);